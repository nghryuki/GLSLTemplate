"use strict";

var GlslParam = function GlslParam() {
    this.w = 1334;
    this.h = 750;
    this.boxRotationX = 0.5;
    this.boxRotationY = 0.5;
    this.isDebug = true;
};
var _glslParam = void 0;
var _glslParamGUI = void 0;

var _threeScene = void 0;
var _threeCamera = void 0;
var _threeRenderer = void 0;

var _cvs = void 0;
var _cvsWrap = void 0;

/* 
    threejs geometry
*/
var _box = void 0;
var _screen = void 0;

/* 
    DOM loaded
*/
document.addEventListener("DOMContentLoaded", awake);
function awake() {}

/* 
    contents loaded
*/
window.addEventListener("load", start);
function start() {
    //
    _cvs = document.getElementById("cvs");
    _cvsWrap = document.getElementById("cvsWrap");
    cvsSizing();

    //
    datInit();

    //
    threeInit();

    //
    window.addEventListener("resize", resize);
}

/* 
    window resized
*/
function resize() {
    cvsSizing();

    threeResizing();
}

/* 
    canvas sizing
*/
function cvsSizing() {
    console.log('cvs sizing');

    _cvs.style.width = _cvsWrap.getBoundingClientRect().width.toString() + "px";
    _cvs.style.height = _cvsWrap.getBoundingClientRect().height.toString() + "px";
}

/* 
    dat.gui init
*/
function datInit() {
    _glslParam = new GlslParam();
    _glslParamGUI = new dat.GUI();
    _glslParamGUI.add(_glslParam, 'w', 0, 1920).onChange(function () {});
    _glslParamGUI.add(_glslParam, 'h', 0, 1080).onChange(function () {});
    _glslParamGUI.add(_glslParam, 'boxRotationX', 0, 5).onChange(function () {
        _box.rotation.x = _glslParam.boxRotationX;
        _threeRenderer.render(_threeScene, _threeCamera);
    });
    _glslParamGUI.add(_glslParam, 'boxRotationY', 0, 5).onChange(function () {
        _box.rotation.y = _glslParam.boxRotationY;
        _threeRenderer.render(_threeScene, _threeCamera);
    });
    _glslParamGUI.add(_glslParam, 'isDebug').onChange(function () {
        console.log("param sw : ", _glslParam.isDebug);
    });
}

/* 
    threejs init
*/
function threeInit() {
    console.log('three init');

    // scene
    _threeScene = new THREE.Scene();

    // camera
    _threeCamera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000);
    _threeCamera.position.set(0, 0, 200);
    _threeCamera.lookAt(new THREE.Vector3(0, 0, 0));

    // renderer
    _threeRenderer = new THREE.WebGLRenderer({
        canvas: _cvs
    });
    _threeRenderer.setSize(window.innerWidth, window.innerHeight);

    // light
    var directionalLight = new THREE.DirectionalLight(0xFFFFFF);
    directionalLight.position.set(1, 1, 1);
    _threeScene.add(directionalLight);
    //
    var ambientLight = new THREE.AmbientLight(0xFFFFFF);
    ambientLight.position.set(0, 1, 0);
    _threeScene.add(ambientLight);

    // ---
    // make object
    var geometry = void 0;
    var material = void 0;

    // box
    geometry = new THREE.BoxGeometry(100, 100, 100);
    material = new THREE.MeshStandardMaterial({ color: 0x0000FF, ambient: 0xFF00FF });
    _box = new THREE.Mesh(geometry, material);
    // _threeScene.add(_box);

    // screen
    geometry = new THREE.PlaneGeometry(120, 120, 32);
    var uniforms = {
        u_resolution: {
            type: "vec2",
            value: new THREE.Vector2(_cvs.style.width, _cvs.style.height)
        },
        u_mouse: {
            type: "vec2",
            value: new THREE.Vector2()
        },
        u_time: {
            type: "f",
            value: new Number()
        }
    };
    material = new THREE.MeshStandardMaterial({ color: 0xFFFF00, side: THREE.DoubleSide });
    var httpObj = new XMLHttpRequest();
    httpObj.open('get', '../_shader/main.vert', true);
    httpObj.onreadystatechange = processResult;
    function processResult() {
        if (httpObj.readyState == 4) {
            if (httpObj.status == 200 || httpObj.status == 201) {
                // リクエストの処理
                console.log('heloo');
                console.log('getget : ', this.responseText);
            } else {
                // エラー処理
            }
        }
    };
    httpObj.send(null);
    // material = new THREE.ShaderMaterial({
    //     vertexShader: document.getElementById("vs").textContent,
    //     fragmentShader: document.getElementById("fs").textContent,
    //     uniforms: uniforms
    // });
    _screen = new THREE.Mesh(geometry, material);
    _threeScene.add(_screen);

    // 初回実行
    _threeRenderer.render(_threeScene, _threeCamera);
}

/* 
    threejs resizing
*/
function threeResizing() {
    console.log('three resizing');

    var w = window.innerWidth;
    var h = window.innerHeight;

    _threeRenderer.setPixelRatio(window.devicePixelRatio);
    _threeRenderer.setSize(w, h);

    _threeCamera.aspect = w / h;
    _threeCamera.updateProjectionMatrix();

    _threeRenderer.render(_threeScene, _threeCamera);
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uZXM2Il0sIm5hbWVzIjpbIkdsc2xQYXJhbSIsInciLCJoIiwiYm94Um90YXRpb25YIiwiYm94Um90YXRpb25ZIiwiaXNEZWJ1ZyIsIl9nbHNsUGFyYW0iLCJfZ2xzbFBhcmFtR1VJIiwiX3RocmVlU2NlbmUiLCJfdGhyZWVDYW1lcmEiLCJfdGhyZWVSZW5kZXJlciIsIl9jdnMiLCJfY3ZzV3JhcCIsIl9ib3giLCJfc2NyZWVuIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiYXdha2UiLCJ3aW5kb3ciLCJzdGFydCIsImdldEVsZW1lbnRCeUlkIiwiY3ZzU2l6aW5nIiwiZGF0SW5pdCIsInRocmVlSW5pdCIsInJlc2l6ZSIsInRocmVlUmVzaXppbmciLCJjb25zb2xlIiwibG9nIiwic3R5bGUiLCJ3aWR0aCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInRvU3RyaW5nIiwiaGVpZ2h0IiwiZGF0IiwiR1VJIiwiYWRkIiwib25DaGFuZ2UiLCJyb3RhdGlvbiIsIngiLCJyZW5kZXIiLCJ5IiwiVEhSRUUiLCJTY2VuZSIsIlBlcnNwZWN0aXZlQ2FtZXJhIiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0IiwicG9zaXRpb24iLCJzZXQiLCJsb29rQXQiLCJWZWN0b3IzIiwiV2ViR0xSZW5kZXJlciIsImNhbnZhcyIsInNldFNpemUiLCJkaXJlY3Rpb25hbExpZ2h0IiwiRGlyZWN0aW9uYWxMaWdodCIsImFtYmllbnRMaWdodCIsIkFtYmllbnRMaWdodCIsImdlb21ldHJ5IiwibWF0ZXJpYWwiLCJCb3hHZW9tZXRyeSIsIk1lc2hTdGFuZGFyZE1hdGVyaWFsIiwiY29sb3IiLCJhbWJpZW50IiwiTWVzaCIsIlBsYW5lR2VvbWV0cnkiLCJ1bmlmb3JtcyIsInVfcmVzb2x1dGlvbiIsInR5cGUiLCJ2YWx1ZSIsIlZlY3RvcjIiLCJ1X21vdXNlIiwidV90aW1lIiwiTnVtYmVyIiwic2lkZSIsIkRvdWJsZVNpZGUiLCJodHRwT2JqIiwiWE1MSHR0cFJlcXVlc3QiLCJvcGVuIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicHJvY2Vzc1Jlc3VsdCIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJyZXNwb25zZVRleHQiLCJzZW5kIiwic2V0UGl4ZWxSYXRpbyIsImRldmljZVBpeGVsUmF0aW8iLCJhc3BlY3QiLCJ1cGRhdGVQcm9qZWN0aW9uTWF0cml4Il0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLFlBQVksU0FBWkEsU0FBWSxHQUNoQjtBQUNJLFNBQUtDLENBQUwsR0FBUyxJQUFUO0FBQ0EsU0FBS0MsQ0FBTCxHQUFTLEdBQVQ7QUFDQSxTQUFLQyxZQUFMLEdBQW9CLEdBQXBCO0FBQ0EsU0FBS0MsWUFBTCxHQUFvQixHQUFwQjtBQUNBLFNBQUtDLE9BQUwsR0FBZSxJQUFmO0FBQ0gsQ0FQRDtBQVFBLElBQUlDLG1CQUFKO0FBQ0EsSUFBSUMsc0JBQUo7O0FBRUEsSUFBSUMsb0JBQUo7QUFDQSxJQUFJQyxxQkFBSjtBQUNBLElBQUlDLHVCQUFKOztBQUVBLElBQUlDLGFBQUo7QUFDQSxJQUFJQyxpQkFBSjs7QUFFQTs7O0FBR0EsSUFBSUMsYUFBSjtBQUNBLElBQUlDLGdCQUFKOztBQUdBOzs7QUFHQUMsU0FBU0MsZ0JBQVQsQ0FBMEIsa0JBQTFCLEVBQThDQyxLQUE5QztBQUNBLFNBQVNBLEtBQVQsR0FDQSxDQUVDOztBQUdEOzs7QUFHQUMsT0FBT0YsZ0JBQVAsQ0FBd0IsTUFBeEIsRUFBZ0NHLEtBQWhDO0FBQ0EsU0FBU0EsS0FBVCxHQUNBO0FBQ0k7QUFDQVIsV0FBT0ksU0FBU0ssY0FBVCxDQUF3QixLQUF4QixDQUFQO0FBQ0FSLGVBQVdHLFNBQVNLLGNBQVQsQ0FBd0IsU0FBeEIsQ0FBWDtBQUNBQzs7QUFFQTtBQUNBQzs7QUFFQTtBQUNBQzs7QUFFQTtBQUNBTCxXQUFPRixnQkFBUCxDQUF3QixRQUF4QixFQUFrQ1EsTUFBbEM7QUFDSDs7QUFHRDs7O0FBR0EsU0FBU0EsTUFBVCxHQUNBO0FBQ0lIOztBQUVBSTtBQUNIOztBQUdEOzs7QUFHQSxTQUFT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QTVDO0FBQ0FGLFlBQVFHLGtCQUFSLEdBQTZCQyxhQUE3QjtBQUNBLGFBQVNBLGFBQVQsR0FDQTtBQUNJLFlBQUdKLFFBQVFLLFVBQVIsSUFBc0IsQ0FBekIsRUFBNEI7QUFDeEIsZ0JBQUdMLFFBQVFNLE1BQVIsSUFBa0IsR0FBbEIsSUFBeUJOLFFBQVFNLE1BQVIsSUFBa0IsR0FBOUMsRUFBbUQ7QUFDL0M7QUFDQXZELHdCQUFRQyxHQUFSLENBQVksT0FBWjtBQUNBRCx3QkFBUUMsR0FBUixDQUFZLFdBQVosRUFBeUIsS0FBS3VELFlBQTlCO0FBQ0gsYUFKRCxNQUlPO0FBQ0g7QUFDSDtBQUNKO0FBQ0o7QUFDRFAsWUFBUVEsSUFBUixDQUFhLElBQWI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FyRSxjQUFVLElBQUkyQixNQUFNc0IsSUFBVixDQUFlTixRQUFmLEVBQXlCQyxRQUF6QixDQUFWO0FBQ0FsRCxnQkFBWTJCLEdBQVosQ0FBZ0JyQixPQUFoQjs7QUFFQTtBQUNBSixtQkFBZTZCLE1BQWYsQ0FBc0IvQixXQUF0QixFQUFtQ0MsWUFBbkM7QUFDSDs7QUFHRDs7O0FBR0EsU0FBU2dCLGFBQVQsR0FDQTtBQUNJQyxZQUFRQyxHQUFSLENBQVksZ0JBQVo7O0FBRUEsUUFBSTFCLElBQUlpQixPQUFPMEIsVUFBZjtBQUNBLFFBQUkxQyxJQUFJZ0IsT0FBTzJCLFdBQWY7O0FBRUFuQyxtQkFBZTBFLGFBQWYsQ0FBNkJsRSxPQUFPbUUsZ0JBQXBDO0FBQ0EzRSxtQkFBZTBDLE9BQWYsQ0FBdUJuRCxDQUF2QixFQUEwQkMsQ0FBMUI7O0FBRUFPLGlCQUFhNkUsTUFBYixHQUFzQnJGLElBQUlDLENBQTFCO0FBQ0FPLGlCQUFhOEUsc0JBQWI7O0FBRUE3RSxtQkFBZTZCLE1BQWYsQ0FBc0IvQixXQUF0QixFQUFtQ0MsWUFBbkM7QUFDSCIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IEdsc2xQYXJhbSA9IGZ1bmN0aW9uKClcbntcbiAgICB0aGlzLncgPSAxMzM0O1xuICAgIHRoaXMuaCA9IDc1MDtcbiAgICB0aGlzLmJveFJvdGF0aW9uWCA9IDAuNTtcbiAgICB0aGlzLmJveFJvdGF0aW9uWSA9IDAuNTtcbiAgICB0aGlzLmlzRGVidWcgPSB0cnVlO1xufTtcbmxldCBfZ2xzbFBhcmFtO1xubGV0IF9nbHNsUGFyYW1HVUk7XG5cbmxldCBfdGhyZWVTY2VuZTtcbmxldCBfdGhyZWVDYW1lcmE7XG5sZXQgX3RocmVlUmVuZGVyZXI7XG5cbmxldCBfY3ZzO1xubGV0IF9jdnNXcmFwO1xuXG4vKiBcbiAgICB0aHJlZWpzIGdlb21ldHJ5XG4qL1xubGV0IF9ib3g7XG5sZXQgX3NjcmVlbjtcblxuXG4vKiBcbiAgICBET00gbG9hZGVkXG4qL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgYXdha2UpO1xuZnVuY3Rpb24gYXdha2UoKVxue1xuXG59XG5cblxuLyogXG4gICAgY29udGVudHMgbG9hZGVkXG4qL1xud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIHN0YXJ0KTtcbmZ1bmN0aW9uIHN0YXJ0KClcbntcbiAgICAvL1xuICAgIF9jdnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImN2c1wiKTtcbiAgICBfY3ZzV3JhcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY3ZzV3JhcFwiKTtcbiAgICBjdnNTaXppbmcoKTtcblxuICAgIC8vXG4gICAgZGF0SW5pdCgpO1xuXG4gICAgLy9cbiAgICB0aHJlZUluaXQoKTtcblxuICAgIC8vXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgcmVzaXplKTtcbn1cblxuXG4vKiBcbiAgICB3aW5kb3cgcmVzaXplZFxuKi9cbmZ1bmN0aW9uIHJlc2l6ZSgpXG57XG4gICAgY3ZzU2l6aW5nKCk7XG4gICAgXG4gICAgdGhyZWVSZXNpemluZygpO1xufVxuXG5cbi8qIFxuICAgIGNhbnZhcyBzaXppbmdcbiovXG5mdW5jdGlvbiBjdnNTaXppbmcoKVxue1xuICAgIGNvbnNvbGUubG9nKCdjdnMgc2l6aW5nJyk7XG4gICAgXG4gICAgX2N2cy5zdHlsZS53aWR0aCA9IF9jdnNXcmFwLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoLnRvU3RyaW5nKCkgKyBcInB4XCI7XG4gICAgX2N2cy5zdHlsZS5oZWlnaHQgPSBfY3ZzV3JhcC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQudG9TdHJpbmcoKSArIFwicHhcIjtcbn1cblxuXG4vKiBcbiAgICBkYXQuZ3VpIGluaXRcbiovXG5mdW5jdGlvbiBkYXRJbml0KClcbntcbiAgICBfZ2xzbFBhcmFtID0gbmV3IEdsc2xQYXJhbSgpO1xuICAgIF9nbHNsUGFyYW1HVUkgPSBuZXcgZGF0LkdVSSgpO1xuICAgIF9nbHNsUGFyYW1HVUkuYWRkKF9nbHNsUGFyYW0sICd3JywgMCwgMTkyMCkub25DaGFuZ2UoKCkgPT5cbiAgICB7XG5cbiAgICB9KTtcbiAgICBfZ2xzbFBhcmFtR1VJLmFkZChfZ2xzbFBhcmFtLCAnaCcsIDAsIDEwODApLm9uQ2hhbmdlKCgpID0+XG4gICAge1xuXG4gICAgfSk7XG4gICAgX2dsc2xQYXJhbUdVSS5hZGQoX2dsc2xQYXJhbSwgJ2JveFJvdGF0aW9uWCcsIDAsIDUpLm9uQ2hhbmdlKCgpID0+XG4gICAge1xuICAgICAgICBfYm94LnJvdGF0aW9uLnggPSBfZ2xzbFBhcmFtLmJveFJvdGF0aW9uWDtcbiAgICAgICAgX3RocmVlUmVuZGVyZXIucmVuZGVyKF90aHJlZVNjZW5lLCBfdGhyZWVDYW1lcmEpO1xuICAgIH0pO1xuICAgIF9nbHNsUGFyYW1HVUkuYWRkKF9nbHNsUGFyYW0sICdib3hSb3RhdGlvblknLCAwLCA1KS5vbkNoYW5nZSgoKSA9PlxuICAgIHtcbiAgICAgICAgX2JveC5yb3RhdGlvbi55ID0gX2dsc2xQYXJhbS5ib3hSb3RhdGlvblk7XG4gICAgICAgIF90aHJlZVJlbmRlcmVyLnJlbmRlcihfdGhyZWVTY2VuZSwgX3RocmVlQ2FtZXJhKTtcbiAgICB9KTtcbiAgICBfZ2xzbFBhcmFtR1VJLmFkZChfZ2xzbFBhcmFtLCAnaXNEZWJ1ZycpLm9uQ2hhbmdlKCgpID0+XG4gICAge1xuICAgICAgICBjb25zb2xlLmxvZyhcInBhcmFtIHN3IDogXCIsIF9nbHNsUGFyYW0uaXNEZWJ1Zyk7XG4gICAgICAgIFxuICAgIH0pO1xufVxuXG5cbi8qIFxuICAgIHRocmVlanMgaW5pdFxuKi9cbmZ1bmN0aW9uIHRocmVlSW5pdCgpXG57XG4gICAgY29uc29sZS5sb2coJ3RocmVlIGluaXQnKTtcblxuICAgIC8vIHNjZW5lXG4gICAgX3RocmVlU2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTtcblxuICAgIC8vIGNhbWVyYVxuICAgIF90aHJlZUNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYSggNzUsIHdpbmRvdy5pbm5lcldpZHRoIC8gd2luZG93LmlubmVySGVpZ2h0LCAwLjEsIDEwMDAwICk7XG4gICAgX3RocmVlQ2FtZXJhLnBvc2l0aW9uLnNldCgwLCAwLCAyMDApO1xuICAgIF90aHJlZUNhbWVyYS5sb29rQXQobmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCkpO1xuXG4gICAgLy8gcmVuZGVyZXJcbiAgICBfdGhyZWVSZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKFxuICAgICAgICB7XG4gICAgICAgICAgICBjYW52YXM6IF9jdnNcbiAgICAgICAgfSk7XG4gICAgX3RocmVlUmVuZGVyZXIuc2V0U2l6ZSggd2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCApO1xuXG4gICAgLy8gbGlnaHRcbiAgICBsZXQgZGlyZWN0aW9uYWxMaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KDB4RkZGRkZGKTtcbiAgICBkaXJlY3Rpb25hbExpZ2h0LnBvc2l0aW9uLnNldCgxLCAxLCAxKTtcbiAgICBfdGhyZWVTY2VuZS5hZGQoZGlyZWN0aW9uYWxMaWdodCk7XG4gICAgLy9cbiAgICBsZXQgYW1iaWVudExpZ2h0ID0gbmV3IFRIUkVFLkFtYmllbnRMaWdodCgweEZGRkZGRik7XG4gICAgYW1iaWVudExpZ2h0LnBvc2l0aW9uLnNldCgwLCAxLCAwKTtcbiAgICBfdGhyZWVTY2VuZS5hZGQoYW1iaWVudExpZ2h0KTtcblxuICAgIC8vIC0tLVxuICAgIC8vIG1ha2Ugb2JqZWN0XG4gICAgbGV0IGdlb21ldHJ5O1xuICAgIGxldCBtYXRlcmlhbDtcblxuICAgIC8vIGJveFxuICAgIGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KDEwMCwgMTAwLCAxMDApO1xuICAgIG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHtjb2xvcjogMHgwMDAwRkYsIGFtYmllbnQ6IDB4RkYwMEZGfSk7XG4gICAgX2JveCA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7XG4gICAgLy8gX3RocmVlU2NlbmUuYWRkKF9ib3gpO1xuXG4gICAgLy8gc2NyZWVuXG4gICAgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSgxMjAsIDEyMCwgMzIpO1xuICAgIGxldCB1bmlmb3JtcyA9IHtcbiAgICAgICAgdV9yZXNvbHV0aW9uOiB7XG4gICAgICAgICAgICB0eXBlOiBcInZlYzJcIixcbiAgICAgICAgICAgIHZhbHVlOiBuZXcgVEhSRUUuVmVjdG9yMihfY3ZzLnN0eWxlLndpZHRoLCBfY3ZzLnN0eWxlLmhlaWdodClcbiAgICAgICAgfSxcbiAgICAgICAgdV9tb3VzZToge1xuICAgICAgICAgICAgdHlwZTogXCJ2ZWMyXCIsXG4gICAgICAgICAgICB2YWx1ZTogbmV3IFRIUkVFLlZlY3RvcjIoKVxuICAgICAgICB9LFxuICAgICAgICB1X3RpbWU6IHtcbiAgICAgICAgICAgIHR5cGU6IFwiZlwiLFxuICAgICAgICAgICAgdmFsdWU6IG5ldyBOdW1iZXIoKVxuICAgICAgICB9XG4gICAgfVxuICAgIG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHtjb2xvcjogMHhGRkZGMDAsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGV9KTtcbiAgICBsZXQgaHR0cE9iaiA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgIGh0dHBPYmoub3BlbignZ2V0JywgJy4uL19zaGFkZXIvbWFpbi52ZXJ0JywgdHJ1ZSk7XG4gICAgaHR0cE9iai5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBwcm9jZXNzUmVzdWx0O1xuICAgIGZ1bmN0aW9uIHByb2Nlc3NSZXN1bHQoKVxuICAgIHtcbiAgICAgICAgaWYoaHR0cE9iai5yZWFkeVN0YXRlID09IDQpIHtcbiAgICAgICAgICAgIGlmKGh0dHBPYmouc3RhdHVzID09IDIwMCB8fCBodHRwT2JqLnN0YXR1cyA9PSAyMDEpIHtcbiAgICAgICAgICAgICAgICAvLyDjg6rjgq/jgqjjgrnjg4jjga7lh6bnkIZcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaGVsb28nKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0Z2V0IDogJywgdGhpcy5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyDjgqjjg6njg7zlh6bnkIZcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgaHR0cE9iai5zZW5kKG51bGwpO1xuICAgIC8vIG1hdGVyaWFsID0gbmV3IFRIUkVFLlNoYWRlck1hdGVyaWFsKHtcbiAgICAvLyAgICAgdmVydGV4U2hhZGVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZzXCIpLnRleHRDb250ZW50LFxuICAgIC8vICAgICBmcmFnbWVudFNoYWRlcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJmc1wiKS50ZXh0Q29udGVudCxcbiAgICAvLyAgICAgdW5pZm9ybXM6IHVuaWZvcm1zXG4gICAgLy8gfSk7XG4gICAgX3NjcmVlbiA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7XG4gICAgX3RocmVlU2NlbmUuYWRkKF9zY3JlZW4pO1xuXG4gICAgLy8g5Yid5Zue5a6f6KGMXG4gICAgX3RocmVlUmVuZGVyZXIucmVuZGVyKF90aHJlZVNjZW5lLCBfdGhyZWVDYW1lcmEpO1xufVxuXG5cbi8qIFxuICAgIHRocmVlanMgcmVzaXppbmdcbiovXG5mdW5jdGlvbiB0aHJlZVJlc2l6aW5nKClcbntcbiAgICBjb25zb2xlLmxvZygndGhyZWUgcmVzaXppbmcnKTtcblxuICAgIGxldCB3ID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgbGV0IGggPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cbiAgICBfdGhyZWVSZW5kZXJlci5zZXRQaXhlbFJhdGlvKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcbiAgICBfdGhyZWVSZW5kZXJlci5zZXRTaXplKHcsIGgpO1xuXG4gICAgX3RocmVlQ2FtZXJhLmFzcGVjdCA9IHcgLyBoO1xuICAgIF90aHJlZUNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7XG5cbiAgICBfdGhyZWVSZW5kZXJlci5yZW5kZXIoX3RocmVlU2NlbmUsIF90aHJlZUNhbWVyYSk7XG59Il19
